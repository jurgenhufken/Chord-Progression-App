<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chord Progression Studio</title>
    <link rel="stylesheet" href="styles.css?v=31">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div class="toolbar">
                    <div class="menu-item">
                        <button class="menu-btn">File</button>
                        <div class="dropdown-menu">
                            <div class="menu-option" id="menuNew">üìÑ New</div>
                            <div class="menu-option" id="menuOpen">üìÇ Open...</div>
                            <div class="menu-option" id="menuSave">üíæ Save</div>
                            <div class="menu-option" id="menuSaveAs">üíæ Save As...</div>
                            <div class="menu-divider"></div>
                            <div class="menu-option" id="menuExportMidi">üéµ Export MIDI</div>
                        </div>
                    </div>
                    <div class="menu-item">
                        <button class="menu-btn">Edit</button>
                        <div class="dropdown-menu">
                            <div class="menu-option" id="menuUndo">‚è™ Undo <span class="shortcut">Ctrl+Z</span></div>
                            <div class="menu-option" id="menuRedo">‚è© Redo <span class="shortcut">Ctrl+Y</span></div>
                            <div class="menu-divider"></div>
                            <div class="menu-option" id="menuCopy">üìã Copy <span class="shortcut">Ctrl+C</span></div>
                            <div class="menu-option" id="menuPaste">üìÑ Paste <span class="shortcut">Ctrl+V</span></div>
                            <div class="menu-option" id="menuDelete">üóëÔ∏è Delete <span class="shortcut">Del</span></div>
                        </div>
                    </div>
                </div>
                <h1>üéµ Chord Progression Studio</h1>
                <div class="transport">
                    <button id="playBtn" class="btn-play">‚ñ∂</button>
                    <button id="stopBtn" class="btn-stop">‚ñ†</button>
                    <button id="loopBtn" class="btn-loop" title="Loop">üîÅ</button>
                    <input type="number" id="bpmInput" value="120" min="60" max="200">
                    <span>BPM</span>
                </div>
            </div>
        </header>
        
        <!-- Hidden file input for opening files -->
        <input type="file" id="fileInput" accept=".json" style="display: none;">

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Sidebar -->
            <aside class="sidebar">
                <div class="section">
                    <h3>Chord Input</h3>
                    <textarea id="chordInput" placeholder="|Am|F|C|G|">|Am|F|C|G|</textarea>
                    <button id="parseBtn" class="btn-primary">Parse</button>
                </div>

                <div class="section">
                    <h3>View</h3>
                    <button id="togglePianoRoll" class="btn-secondary">üëÅÔ∏è Piano Roll</button>
                    <label>Range: 
                        <select id="pianoRange">
                            <option value="auto" selected>Auto (Smart)</option>
                            <option value="full">Full (C0-C8)</option>
                        </select>
                    </label>
                </div>

                <div class="section">
                    <h3>Edit Mode</h3>
                    <button id="toggleEditMode" class="btn-secondary">‚úèÔ∏è Edit</button>
                    <button id="toggleOriginal" class="btn-secondary">üìÑ Original</button>
                    <button id="clearAll" class="btn-secondary">üóëÔ∏è Clear All</button>
                </div>

                <div class="section">
                    <h3>Chord Designer</h3>
                    <div class="chord-designer">
                        <!-- Chord Display -->
                        <div class="chord-display">
                            <label>Chord</label>
                            <input type="text" id="chordDisplay" readonly value="C">
                        </div>
                        
                        <!-- Root Note Dropdown -->
                        <div class="chord-param">
                            <label>Root Note</label>
                            <select id="rootNoteSelect" class="chord-dropdown">
                                <option value="C">C</option>
                                <option value="C#">C#</option>
                                <option value="D">D</option>
                                <option value="D#">D#</option>
                                <option value="E">E</option>
                                <option value="F">F</option>
                                <option value="F#">F#</option>
                                <option value="G">G</option>
                                <option value="G#">G#</option>
                                <option value="A">A</option>
                                <option value="A#">A#</option>
                                <option value="B">B</option>
                            </select>
                        </div>
                        
                        <!-- Quality Buttons Grid -->
                        <div class="quality-grid">
                            <button class="quality-btn active" data-quality="">Maj</button>
                            <button class="quality-btn" data-quality="m">Min</button>
                            <button class="quality-btn" data-quality="sus2">Sus2</button>
                            <button class="quality-btn" data-quality="sus4">Sus4</button>
                            
                            <button class="quality-btn" data-quality="5">5</button>
                            <button class="quality-btn" data-quality="aug">Aug</button>
                            <button class="quality-btn" data-quality="dim">Dim</button>
                            <button class="quality-btn" data-quality="b5">‚ô≠5</button>
                            
                            <button class="quality-btn" data-quality="#5">#5</button>
                            <button class="quality-btn" data-quality="6">6</button>
                            <button class="quality-btn" data-quality="7">7</button>
                            <button class="quality-btn" data-quality="maj7">maj7</button>
                            
                            <button class="quality-btn" data-quality="b9">‚ô≠9</button>
                            <button class="quality-btn" data-quality="9">9</button>
                            <button class="quality-btn" data-quality="#9">#9</button>
                            <button class="quality-btn" data-quality="11">11</button>
                            
                            <button class="quality-btn" data-quality="#11">#11</button>
                            <button class="quality-btn" data-quality="b13">‚ô≠13</button>
                            <button class="quality-btn" data-quality="13">13</button>
                        </div>
                        
                        <!-- Quick Controls -->
                        <div class="chord-param" style="background: rgba(0,212,255,0.1); padding: 0.5rem; border-radius: 4px;">
                            <label style="color: #00d4ff;">‚ö° Quick Controls</label>
                            <div style="display: grid; grid-template-columns: auto 1fr auto; gap: 0.5rem; align-items: center;">
                                <!-- Root -->
                                <span style="font-size: 0.8rem; color: #888;">Root:</span>
                                <div style="display: flex; gap: 0.25rem;">
                                    <button id="rootDown" class="step-btn-compact" title="Previous note">‚óÑ</button>
                                    <button id="rootUp" class="step-btn-compact" title="Next note">‚ñ∫</button>
                                </div>
                                <span id="rootDisplay" style="font-size: 0.85rem; color: #00d4ff; min-width: 25px;">C</span>
                                
                                <!-- Voicing Step -->
                                <span style="font-size: 0.8rem; color: #888;">Voicing:</span>
                                <div style="display: flex; gap: 0.25rem;">
                                    <button id="arpeggioDown" class="step-btn-compact" title="Previous voicing (inversion/octave)">‚óÑ</button>
                                    <button id="arpeggioUp" class="step-btn-compact" title="Next voicing (inversion/octave)">‚ñ∫</button>
                                </div>
                                <span id="arpeggioDisplay" style="font-size: 0.85rem; color: #00d4ff; min-width: 35px;">C4</span>
                                
                                <!-- Voice Count -->
                                <span style="font-size: 0.8rem; color: #888;">Voices:</span>
                                <div style="display: flex; gap: 0.25rem;">
                                    <button id="voicesDown" class="step-btn-compact" title="Fewer notes">‚óÑ</button>
                                    <button id="voicesUp" class="step-btn-compact" title="More notes">‚ñ∫</button>
                                </div>
                                <span id="voicesDisplay" style="font-size: 0.85rem; color: #00d4ff; min-width: 35px;">3</span>
                                
                                <!-- Octave -->
                                <span style="font-size: 0.8rem; color: #888;">Oct:</span>
                                <div style="display: flex; gap: 0.25rem;">
                                    <button id="octaveDown" class="step-btn-compact" title="Lower octave">‚óÑ</button>
                                    <button id="octaveUp" class="step-btn-compact" title="Higher octave">‚ñ∫</button>
                                </div>
                                <span id="octaveDisplay" style="font-size: 0.85rem; color: #00d4ff; min-width: 25px;">4</span>
                                
                                <!-- Inversion -->
                                <span style="font-size: 0.8rem; color: #888;">Inv:</span>
                                <div style="display: flex; gap: 0.25rem;">
                                    <button id="inversionDown" class="step-btn-compact" title="Previous inversion">‚óÑ</button>
                                    <button id="inversionUp" class="step-btn-compact" title="Next inversion">‚ñ∫</button>
                                </div>
                                <span id="inversionDisplay" style="font-size: 0.85rem; color: #00d4ff; min-width: 25px;">0</span>
                            </div>
                        </div>
                        
                        <!-- Octave (hidden dropdown for compatibility) -->
                        <select id="octaveSelect" class="chord-dropdown" style="display: none;">
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4" selected>4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                        </select>
                        
                        <!-- Inversion (hidden dropdown for compatibility) -->
                        <select id="inversionSelect" class="chord-dropdown" style="display: none;">
                            <option value="0">Root Position</option>
                            <option value="1">1st Inversion</option>
                            <option value="2">2nd Inversion</option>
                            <option value="3">3rd Inversion</option>
                        </select>
                        
                        <!-- Bass Note -->
                        <div class="chord-param">
                            <label>Bass Note</label>
                            <select id="bassNoteSelect" class="chord-dropdown">
                                <option value="">None</option>
                                <option value="C">C</option>
                                <option value="C#">C#</option>
                                <option value="D">D</option>
                                <option value="D#">D#</option>
                                <option value="E">E</option>
                                <option value="F">F</option>
                                <option value="F#">F#</option>
                                <option value="G">G</option>
                                <option value="G#">G#</option>
                                <option value="A">A</option>
                                <option value="A#">A#</option>
                                <option value="B">B</option>
                            </select>
                        </div>
                        
                        <!-- Scale -->
                        <div class="chord-param">
                            <label>Scale</label>
                            <select id="scaleSelect" class="chord-dropdown">
                                <option value="auto">Auto (Major (Ionian))</option>
                                <option value="major">Major (Ionian)</option>
                                <option value="minor">Natural Minor (Aeolian)</option>
                                <option value="dorian">Dorian</option>
                                <option value="phrygian">Phrygian</option>
                                <option value="lydian">Lydian</option>
                                <option value="mixolydian">Mixolydian</option>
                                <option value="locrian">Locrian</option>
                                <option value="harmonic-minor">Harmonic Minor</option>
                                <option value="melodic-minor">Melodic Minor</option>
                                <option value="pentatonic-major">Major Pentatonic</option>
                                <option value="pentatonic-minor">Minor Pentatonic</option>
                                <option value="blues">Blues</option>
                            </select>
                        </div>
                        
                        <!-- Lock Toggle -->
                        <div class="chord-lock">
                            <label>
                                <input type="checkbox" id="chordLock">
                                <span>üîí Lock to Piano Roll (Auto-sync)</span>
                            </label>
                        </div>
                        
                        <button id="applyChord" class="btn-primary" style="margin-top: 0.5rem; width: 100%;">Apply to Selected Bar</button>
                    </div>
                </div>

                <div class="section">
                    <h3>Interval Analysis</h3>
                    <div class="interval-analysis">
                        <div class="interval-display" id="intervalDisplay">
                            <div class="interval-type">-</div>
                            <div class="interval-semitones">-</div>
                        </div>
                        <div class="melodic-info" id="melodicInfo">
                            Select notes to see interval analysis
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>üéõÔ∏è Modulation</h3>
                    <div class="modulation-widget" id="modulationWidget">
                        <div class="mod-status">
                            <div class="mod-lfo-info">
                                <span class="mod-label">LFO1:</span>
                                <span id="lfo1Status">1/4 Sine</span>
                                <div class="lfo-meter">
                                    <div class="lfo-meter-bar" id="lfo1Meter"></div>
                                </div>
                            </div>
                            <div class="mod-lfo-info">
                                <span class="mod-label">LFO2:</span>
                                <span id="lfo2Status">1/8 Tri</span>
                                <div class="lfo-meter">
                                    <div class="lfo-meter-bar" id="lfo2Meter"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mod-footer">
                            <span id="modActiveCount">0 active</span>
                            <button class="mod-settings-btn" id="openModMatrix" title="Open Modulation Matrix">‚öôÔ∏è</button>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Bars</h3>
                    <button id="addBar" class="btn-secondary">‚ûï Add Bar</button>
                </div>

                <div class="section">
                    <h3>Transpose</h3>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button id="transposeDown12" class="btn-secondary" title="Down 1 octave">-12</button>
                        <button id="transposeDown1" class="btn-secondary" title="Down 1 semitone">-1</button>
                        <button id="transposeUp1" class="btn-secondary" title="Up 1 semitone">+1</button>
                        <button id="transposeUp12" class="btn-secondary" title="Up 1 octave">+12</button>
                    </div>
                    <small style="color: #888;">Selected notes or all if none selected</small>
                </div>

                <div class="section">
                    <h3>Arpeggiator</h3>
                    <label>
                        <input type="checkbox" id="arpEnabled"> Enable Arp
                    </label>
                    <label>
                        <input type="checkbox" id="arpVisualizer" checked> Visualizer
                    </label>
                    <label>Pattern:
                        <select id="arpPattern">
                            <option value="up">Up</option>
                            <option value="down">Down</option>
                            <option value="updown">Up-Down</option>
                            <option value="random">Random</option>
                        </select>
                    </label>
                    <label>Speed:
                        <select id="arpSpeed">
                            <option value="1/16">1/16</option>
                            <option value="1/8" selected>1/8</option>
                            <option value="1/4">1/4</option>
                        </select>
                    </label>
                    <label>Octaves: <input type="number" id="arpOctaves" min="1" max="3" value="1" style="width: 50px;"></label>
                    <label>Trigger:
                        <select id="arpTrigger">
                            <option value="retrigger">Retrigger</option>
                            <option value="legato">Legato</option>
                        </select>
                    </label>
                    <label>Mode:
                        <select id="arpMode">
                            <option value="chord">Per Chord</option>
                            <option value="run" selected>Run (Continuous)</option>
                        </select>
                    </label>
                </div>

                <div class="section">
                    <h3>üéπ Synth Designer</h3>
                    
                    <!-- Presets -->
                    <div class="synth-presets" style="display: flex; gap: 0.25rem; margin-bottom: 0.75rem;">
                        <button class="preset-btn" data-preset="pad">Pad</button>
                        <button class="preset-btn" data-preset="lead">Lead</button>
                        <button class="preset-btn" data-preset="bass">Bass</button>
                        <button class="preset-btn" data-preset="pluck">Pluck</button>
                    </div>
                    
                    <label>Volume: <input type="range" id="volume" min="0" max="100" value="70"></label>
                    <label>Waveform:
                        <select id="waveform">
                            <option value="sawtooth">Sawtooth (Rich)</option>
                            <option value="square">Square (Hollow)</option>
                            <option value="triangle" selected>Triangle (Soft)</option>
                            <option value="sine">Sine (Pure)</option>
                        </select>
                    </label>
                    
                    <!-- Amplitude Envelope -->
                    <details open style="margin-top: 0.5rem;">
                        <summary style="cursor: pointer; color: #00d4ff;">Amp Envelope (ADSR)</summary>
                        <div style="padding-left: 0.5rem; margin-top: 0.5rem;">
                            <label style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Attack:</span>
                                <input type="range" id="attack" min="0" max="5" step="0.01" value="0.01" style="flex: 1; margin: 0 0.5rem;">
                                <span id="attackValue" style="min-width: 50px; text-align: right; color: #00d4ff;">0.01s</span>
                            </label>
                            <label style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Decay:</span>
                                <input type="range" id="decay" min="0" max="5" step="0.01" value="0.1" style="flex: 1; margin: 0 0.5rem;">
                                <span id="decayValue" style="min-width: 50px; text-align: right; color: #00d4ff;">0.1s</span>
                            </label>
                            <label style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Sustain:</span>
                                <input type="range" id="sustain" min="0" max="1" step="0.01" value="0.9" style="flex: 1; margin: 0 0.5rem;">
                                <span id="sustainValue" style="min-width: 50px; text-align: right; color: #00d4ff;">0.9</span>
                            </label>
                            <label style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Release:</span>
                                <input type="range" id="release" min="0" max="10" step="0.01" value="0.3" style="flex: 1; margin: 0 0.5rem;">
                                <span id="releaseValue" style="min-width: 50px; text-align: right; color: #00d4ff;">0.3s</span>
                            </label>
                        </div>
                    </details>
                    
                    <label style="margin-top: 0.5rem;">
                        <input type="checkbox" id="notePreview" checked> Note Preview
                    </label>
                </div>

                <div class="section">
                    <h3>Filter</h3>
                    <label>Cutoff: <input type="range" id="filterCutoff" min="20" max="20000" value="5000" step="10"></label>
                    <small style="color: #888;">Lower = darker, Higher = brighter</small>
                    <label>Resonance: <input type="range" id="filterResonance" min="0" max="30" value="1" step="0.1"></label>
                    <small style="color: #888;">Higher = more emphasis at cutoff</small>
                    <label>Type:
                        <select id="filterType">
                            <option value="lowpass" selected>Lowpass (Cut highs)</option>
                            <option value="highpass">Highpass (Cut lows)</option>
                            <option value="bandpass">Bandpass (Cut both)</option>
                        </select>
                    </label>
                </div>

                <div class="section">
                    <h3>Effects</h3>
                    <label>Delay: <input type="range" id="delayTime" min="0" max="1" value="0" step="0.01"></label>
                    <label>Feedback: <input type="range" id="delayFeedback" min="0" max="0.9" value="0" step="0.01"></label>
                    <label>Reverb: <input type="range" id="reverbWet" min="0" max="1" value="0" step="0.01"></label>
                </div>

                <div class="section">
                    <h3>Loop Range</h3>
                    <label>Start: <input type="number" id="loopStart" min="1" value="1" style="width: 50px;"></label>
                    <label>End: <input type="number" id="loopEnd" min="1" value="4" style="width: 50px;"></label>
                    <small style="color: #888;">Loop from bar X to bar Y</small>
                </div>

                <div class="section">
                    <h3>Export</h3>
                    <button id="exportMidi" class="btn-secondary">Export MIDI</button>
                </div>
                
                <div class="section help-text">
                    <h4>üéπ Edit Mode Shortcuts:</h4>
                    <small>
                        ‚Ä¢ Click cell to add note<br>
                        ‚Ä¢ Click note to select<br>
                        ‚Ä¢ Ctrl+Click for multi-select<br>
                        ‚Ä¢ Delete to remove<br>
                        ‚Ä¢ Ctrl+C to copy<br>
                        ‚Ä¢ Ctrl+V to paste<br>
                        ‚Ä¢ + button to add chord
                    </small>
                </div>
            </aside>

            <!-- Grid Area -->
            <main class="grid-area">
                <!-- Loop Range Slider (Logic Pro style) -->
                <div class="loop-slider-container">
                    <div class="loop-slider-track" id="loopSliderTrack">
                        <div class="loop-slider-range" id="loopSliderRange">
                            <div class="loop-handle loop-handle-start" id="loopHandleStart"></div>
                            <div class="loop-handle loop-handle-end" id="loopHandleEnd"></div>
                        </div>
                    </div>
                    <div class="loop-slider-labels" id="loopSliderLabels"></div>
                </div>
                
                <!-- Grid Wrapper for horizontal scroll -->
                <div class="grid-wrapper">
                    <!-- Vertical Ruler (Bar Numbers) -->
                    <div class="vertical-ruler" id="verticalRuler"></div>
                    
                    <div id="gridContainer" class="grid-container">
                        <!-- Grid will be generated here -->
                    </div>
                </div>
                
                <!-- Drum Sequencer -->
                <div class="drum-sequencer" id="drumSequencer">
                    <div class="drum-header">
                        <h3>ü•Å Drum Sequencer</h3>
                        <div class="drum-controls">
                            <button class="drum-preset-btn" data-pattern="basic">Basic</button>
                            <button class="drum-preset-btn" data-pattern="funk">Funk</button>
                            <button class="drum-preset-btn" data-pattern="dnb">DnB</button>
                            <button class="drum-preset-btn" data-pattern="clear">Clear</button>
                            <span style="color: #888; margin: 0 1rem;">|</span>
                            <button class="drum-action-btn" id="drumCopy">Copy Bar</button>
                            <button class="drum-action-btn" id="drumPaste">Paste Bar</button>
                            <button class="drum-action-btn" id="drumFillRange">Fill Range...</button>
                            <button class="drum-action-btn" id="drumAutoFill">Auto-Fill All</button>
                            <span style="color: #888; margin: 0 1rem;">|</span>
                            <label style="color: #ccc; font-size: 0.85rem;">
                                Zoom:
                                <select id="drumZoom" style="background: #2a2a2a; color: white; border: 1px solid #555; padding: 0.25rem; border-radius: 4px;">
                                    <option value="1">1x</option>
                                    <option value="2" selected>2x</option>
                                    <option value="3">3x</option>
                                    <option value="4">4x</option>
                                </select>
                            </label>
                            <label style="color: #ccc; font-size: 0.85rem; margin-left: 0.5rem;">
                                <input type="checkbox" id="drumFollowPlayhead" checked> Follow Playhead
                            </label>
                        </div>
                    </div>
                    <div class="drum-grid-wrapper">
                        <div class="drum-playhead" id="drumPlayhead"></div>
                        <div id="drumGrid" class="drum-grid-horizontal">
                            <!-- Drum grid will be generated here -->
                        </div>
                    </div>
                    
                    <!-- Drum Parameters (shown when track selected) -->
                    <div id="drumParameters" class="drum-parameters" style="display: none;">
                        <h4 id="drumParamTitle">Kick Parameters</h4>
                        <div class="drum-param-grid">
                            <div class="drum-param-row">
                                <label>Velocity:</label>
                                <div id="velocitySliders" class="param-sliders"></div>
                            </div>
                            <div class="drum-param-row">
                                <label>Duration:</label>
                                <div id="durationSliders" class="param-sliders"></div>
                            </div>
                            <div class="drum-param-row">
                                <label>Gate:</label>
                                <div id="gateSliders" class="param-sliders"></div>
                            </div>
                            <div class="drum-param-row">
                                <label>Ratchet:</label>
                                <div id="ratchetSliders" class="param-sliders"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Drum Effects Routing -->
                    <div class="drum-effects-section">
                        <h4>üéöÔ∏è Drum Effects Routing</h4>
                        <div id="drumEffectsRouting" class="drum-effects-routing">
                            <!-- Effects routing will be generated here -->
                        </div>
                    </div>
                </div>
                
                <!-- Analysis Panel -->
                <div class="analysis-panel" id="analysisPanel">
                    <h3>üéº Music Theory Analysis</h3>
                    <div class="analysis-content">
                        <div class="analysis-section">
                            <h4>Current Selection:</h4>
                            <div id="selectionAnalysis">Click a chord or select notes to analyze</div>
                        </div>
                        <div class="analysis-section">
                            <h4>Progression Analysis:</h4>
                            <div id="progressionAnalysis">Parse chords to see analysis</div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Context Menu -->
        <div id="contextMenu" class="context-menu" style="display: none;">
            <div class="context-menu-item" id="contextCut">‚úÇÔ∏è Cut</div>
            <div class="context-menu-item" id="contextCopy">üìã Copy</div>
            <div class="context-menu-item" id="contextPaste">üìÑ Paste</div>
            <div class="context-menu-divider"></div>
            <div class="context-menu-item" id="contextDelete">üóëÔ∏è Delete</div>
        </div>

        <!-- Chord Suggestions Panel (Hidden by default) -->
        <div id="suggestionsPanel" class="suggestions-panel" style="display: none;">
            <div class="panel-header">
                <h3>What's Next?</h3>
                <button id="closeSuggestions" class="btn-close-panel">‚úï</button>
            </div>
            <div class="panel-content">
                <div class="suggestion-section">
                    <h4>Suggested Chords:</h4>
                    <div id="chordSuggestions" class="suggestion-buttons">
                        <!-- Suggestions will be generated here -->
                    </div>
                </div>
                <div class="suggestion-section">
                    <h4>Build Your Own:</h4>
                    <div class="chord-builder">
                        <label>Bass Note:</label>
                        <div id="bassNotes" class="note-buttons">
                            <!-- Bass notes will be generated here -->
                        </div>
                        <label>Chord Type:</label>
                        <div id="chordTypes" class="type-buttons">
                            <!-- Chord types will be generated here -->
                        </div>
                        <button id="previewBuilding" class="btn-preview" style="margin-top: 1rem; width: 100%;">
                            ‚ñ∂ Preview Chord
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modulation Matrix Floating Panel -->
    <div class="mod-matrix-panel" id="modMatrixPanel" style="display: none;">
        <div class="mod-matrix-header">
            <h3>üéõÔ∏è Modulation Matrix</h3>
            <button class="btn-close-panel" id="closeModMatrix">‚úï</button>
        </div>
        <div class="mod-matrix-content">
            <!-- LFO 1 -->
            <div class="lfo-section">
                <h4>LFO 1</h4>
                <div class="lfo-controls">
                    <label>
                        Rate:
                        <select id="lfo1Rate" class="mod-select">
                            <option value="1">1 bar</option>
                            <option value="0.5">1/2</option>
                            <option value="0.25" selected>1/4</option>
                            <option value="0.125">1/8</option>
                            <option value="0.0625">1/16</option>
                        </select>
                    </label>
                    <label>
                        Depth:
                        <input type="range" id="lfo1Depth" min="0" max="100" value="50" class="mod-slider">
                        <span id="lfo1DepthValue">50%</span>
                    </label>
                    <label>Waveform:</label>
                    <div class="waveform-buttons">
                        <button class="wave-btn active" data-lfo="1" data-wave="sine">‚óã Sine</button>
                        <button class="wave-btn" data-lfo="1" data-wave="triangle">‚ñ≥ Tri</button>
                        <button class="wave-btn" data-lfo="1" data-wave="square">‚ñ° Sqr</button>
                        <button class="wave-btn" data-lfo="1" data-wave="sawtooth">‚äø Saw</button>
                        <button class="wave-btn" data-lfo="1" data-wave="random">‚ö° Rnd</button>
                    </div>
                </div>
            </div>

            <!-- LFO 2 -->
            <div class="lfo-section">
                <h4>LFO 2</h4>
                <div class="lfo-controls">
                    <label>
                        Rate:
                        <select id="lfo2Rate" class="mod-select">
                            <option value="1">1 bar</option>
                            <option value="0.5">1/2</option>
                            <option value="0.25">1/4</option>
                            <option value="0.125" selected>1/8</option>
                            <option value="0.0625">1/16</option>
                        </select>
                    </label>
                    <label>
                        Depth:
                        <input type="range" id="lfo2Depth" min="0" max="100" value="75" class="mod-slider">
                        <span id="lfo2DepthValue">75%</span>
                    </label>
                    <label>Waveform:</label>
                    <div class="waveform-buttons">
                        <button class="wave-btn" data-lfo="2" data-wave="sine">‚óã Sine</button>
                        <button class="wave-btn active" data-lfo="2" data-wave="triangle">‚ñ≥ Tri</button>
                        <button class="wave-btn" data-lfo="2" data-wave="square">‚ñ° Sqr</button>
                        <button class="wave-btn" data-lfo="2" data-wave="sawtooth">‚äø Saw</button>
                        <button class="wave-btn" data-lfo="2" data-wave="random">‚ö° Rnd</button>
                    </div>
                </div>
            </div>

            <!-- Learn Mode -->
            <div class="routing-section">
                <h4>Map to Parameter</h4>
                <p style="color: #888; font-size: 0.85rem; margin-bottom: 1rem;">
                    Click a button below, then click any parameter in the sidebar to map it.
                </p>
                <div class="learn-buttons">
                    <button class="learn-btn" id="learnLFO1" data-lfo="lfo1">
                        üéõÔ∏è Learn LFO 1
                    </button>
                    <button class="learn-btn" id="learnLFO2" data-lfo="lfo2">
                        üéõÔ∏è Learn LFO 2
                    </button>
                </div>
                <div id="learnStatus" style="margin-top: 1rem; color: #00d4ff; font-size: 0.9rem; min-height: 20px;">
                    <!-- Status messages appear here -->
                </div>
                <div class="routing-list" style="margin-top: 1rem;">
                    <h4 style="margin-bottom: 0.5rem;">Active Mappings:</h4>
                    <div id="activeMappings" style="color: #888; font-size: 0.85rem;">
                        No mappings yet
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <script src="https://unpkg.com/midi-writer-js@2.1.4/build/index.js"></script>
    <script src="app.js?v=31"></script>
</body>
</html>
